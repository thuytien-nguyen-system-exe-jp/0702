/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/products/route";
exports.ids = ["app/api/products/route"];
exports.modules = {

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fproducts%2Froute&page=%2Fapi%2Fproducts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproducts%2Froute.ts&appDir=C%3A%5CUsers%5Cthuytien.nguyen.SYSTEM-EXE%5CDesktop%5C0702%5Cvietnamese-ecommerce%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cthuytien.nguyen.SYSTEM-EXE%5CDesktop%5C0702%5Cvietnamese-ecommerce&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fproducts%2Froute&page=%2Fapi%2Fproducts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproducts%2Froute.ts&appDir=C%3A%5CUsers%5Cthuytien.nguyen.SYSTEM-EXE%5CDesktop%5C0702%5Cvietnamese-ecommerce%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cthuytien.nguyen.SYSTEM-EXE%5CDesktop%5C0702%5Cvietnamese-ecommerce&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_thuytien_nguyen_SYSTEM_EXE_Desktop_0702_vietnamese_ecommerce_src_app_api_products_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/products/route.ts */ \"(rsc)/./src/app/api/products/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/products/route\",\n        pathname: \"/api/products\",\n        filename: \"route\",\n        bundlePath: \"app/api/products/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\thuytien.nguyen.SYSTEM-EXE\\\\Desktop\\\\0702\\\\vietnamese-ecommerce\\\\src\\\\app\\\\api\\\\products\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_thuytien_nguyen_SYSTEM_EXE_Desktop_0702_vietnamese_ecommerce_src_app_api_products_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZwcm9kdWN0cyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGcHJvZHVjdHMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZwcm9kdWN0cyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUN0aHV5dGllbi5uZ3V5ZW4uU1lTVEVNLUVYRSU1Q0Rlc2t0b3AlNUMwNzAyJTVDdmlldG5hbWVzZS1lY29tbWVyY2UlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q3RodXl0aWVuLm5ndXllbi5TWVNURU0tRVhFJTVDRGVza3RvcCU1QzA3MDIlNUN2aWV0bmFtZXNlLWVjb21tZXJjZSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDNkQ7QUFDMUk7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFVzZXJzXFxcXHRodXl0aWVuLm5ndXllbi5TWVNURU0tRVhFXFxcXERlc2t0b3BcXFxcMDcwMlxcXFx2aWV0bmFtZXNlLWVjb21tZXJjZVxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxwcm9kdWN0c1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvcHJvZHVjdHMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9wcm9kdWN0c1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvcHJvZHVjdHMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFx0aHV5dGllbi5uZ3V5ZW4uU1lTVEVNLUVYRVxcXFxEZXNrdG9wXFxcXDA3MDJcXFxcdmlldG5hbWVzZS1lY29tbWVyY2VcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccHJvZHVjdHNcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fproducts%2Froute&page=%2Fapi%2Fproducts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproducts%2Froute.ts&appDir=C%3A%5CUsers%5Cthuytien.nguyen.SYSTEM-EXE%5CDesktop%5C0702%5Cvietnamese-ecommerce%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cthuytien.nguyen.SYSTEM-EXE%5CDesktop%5C0702%5Cvietnamese-ecommerce&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/products/route.ts":
/*!***************************************!*\
  !*** ./src/app/api/products/route.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v3/ZodError.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n\n\n\n\n// クエリパラメータのバリデーションスキーマ\nconst productQuerySchema = zod__WEBPACK_IMPORTED_MODULE_3__.object({\n    page: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional().transform((val)=>val ? parseInt(val) : 1),\n    limit: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional().transform((val)=>val ? parseInt(val) : 12),\n    category: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n    brand: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n    search: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional(),\n    minPrice: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional().transform((val)=>val ? parseFloat(val) : undefined),\n    maxPrice: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional().transform((val)=>val ? parseFloat(val) : undefined),\n    spiceLevel: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional().transform((val)=>val ? val.split(',').map(Number) : undefined),\n    storageType: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional().transform((val)=>val ? val.split(',') : undefined),\n    inStock: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional().transform((val)=>val === 'true'),\n    featured: zod__WEBPACK_IMPORTED_MODULE_3__.string().optional().transform((val)=>val === 'true'),\n    sortBy: zod__WEBPACK_IMPORTED_MODULE_3__[\"enum\"]([\n        'name',\n        'price',\n        'created',\n        'popularity'\n    ]).optional().default('created'),\n    sortOrder: zod__WEBPACK_IMPORTED_MODULE_3__[\"enum\"]([\n        'asc',\n        'desc'\n    ]).optional().default('desc')\n});\n// 商品一覧取得\nasync function GET(request) {\n    try {\n        const headers = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getSecurityHeaders)();\n        const { searchParams } = new URL(request.url);\n        // クエリパラメータをオブジェクトに変換\n        const queryObject = {};\n        searchParams.forEach((value, key)=>{\n            queryObject[key] = value;\n        });\n        // バリデーション\n        const validatedQuery = productQuerySchema.parse(queryObject);\n        const { page, limit, category, brand, search, minPrice, maxPrice, spiceLevel, storageType, inStock, featured, sortBy, sortOrder } = validatedQuery;\n        // フィルター条件を構築\n        const where = {\n            isActive: true\n        };\n        if (category) {\n            where.categoryId = category;\n        }\n        if (brand) {\n            where.brandId = brand;\n        }\n        if (search) {\n            where.OR = [\n                {\n                    nameJa: {\n                        contains: search,\n                        mode: 'insensitive'\n                    }\n                },\n                {\n                    nameVi: {\n                        contains: search,\n                        mode: 'insensitive'\n                    }\n                },\n                {\n                    descriptionJa: {\n                        contains: search,\n                        mode: 'insensitive'\n                    }\n                },\n                {\n                    descriptionVi: {\n                        contains: search,\n                        mode: 'insensitive'\n                    }\n                }\n            ];\n        }\n        if (minPrice !== undefined || maxPrice !== undefined) {\n            where.price = {};\n            if (minPrice !== undefined) where.price.gte = minPrice;\n            if (maxPrice !== undefined) where.price.lte = maxPrice;\n        }\n        if (spiceLevel && spiceLevel.length > 0) {\n            where.spiceLevel = {\n                in: spiceLevel\n            };\n        }\n        if (storageType && storageType.length > 0) {\n            where.storageType = {\n                in: storageType\n            };\n        }\n        if (inStock) {\n            where.stockQuantity = {\n                gt: 0\n            };\n        }\n        if (featured) {\n            where.isFeatured = true;\n        }\n        // ソート条件を構築\n        const orderBy = {};\n        switch(sortBy){\n            case 'name':\n                orderBy.nameJa = sortOrder;\n                break;\n            case 'price':\n                orderBy.price = sortOrder;\n                break;\n            case 'created':\n                orderBy.createdAt = sortOrder;\n                break;\n            case 'popularity':\n                // 人気度は注文数やレビュー数で判断（簡易版）\n                orderBy.createdAt = sortOrder;\n                break;\n            default:\n                orderBy.createdAt = 'desc';\n        }\n        // ページネーション計算\n        const skip = (page - 1) * limit;\n        // 商品データ取得\n        const [products, totalCount] = await Promise.all([\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.product.findMany({\n                where,\n                include: {\n                    category: {\n                        select: {\n                            id: true,\n                            nameJa: true,\n                            nameVi: true,\n                            slug: true\n                        }\n                    },\n                    brand: {\n                        select: {\n                            id: true,\n                            name: true,\n                            slug: true\n                        }\n                    },\n                    images: {\n                        orderBy: {\n                            sortOrder: 'asc'\n                        },\n                        take: 3\n                    },\n                    variants: {\n                        where: {\n                            isActive: true\n                        },\n                        select: {\n                            id: true,\n                            name: true,\n                            value: true,\n                            priceModifier: true,\n                            stockQuantity: true\n                        }\n                    },\n                    reviews: {\n                        select: {\n                            rating: true\n                        }\n                    }\n                },\n                orderBy,\n                skip,\n                take: limit\n            }),\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.product.count({\n                where\n            })\n        ]);\n        // レビュー平均評価を計算\n        const productsWithRating = products.map((product)=>{\n            const ratings = product.reviews.map((r)=>r.rating);\n            const averageRating = ratings.length > 0 ? ratings.reduce((sum, rating)=>sum + rating, 0) / ratings.length : 0;\n            return {\n                ...product,\n                averageRating: Math.round(averageRating * 10) / 10,\n                reviewCount: ratings.length,\n                reviews: undefined // レビュー詳細は除外\n            };\n        });\n        // ページネーション情報\n        const totalPages = Math.ceil(totalCount / limit);\n        const pagination = {\n            currentPage: page,\n            totalPages,\n            totalCount,\n            hasNext: page < totalPages,\n            hasPrev: page > 1,\n            limit\n        };\n        // フィルター用のメタデータを取得\n        const [categories, brands, priceRange] = await Promise.all([\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.category.findMany({\n                where: {\n                    isActive: true\n                },\n                select: {\n                    id: true,\n                    nameJa: true,\n                    nameVi: true,\n                    slug: true\n                },\n                orderBy: {\n                    sortOrder: 'asc'\n                }\n            }),\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.brand.findMany({\n                where: {\n                    isActive: true\n                },\n                select: {\n                    id: true,\n                    name: true,\n                    slug: true\n                },\n                orderBy: {\n                    name: 'asc'\n                }\n            }),\n            _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.product.aggregate({\n                where: {\n                    isActive: true\n                },\n                _min: {\n                    price: true\n                },\n                _max: {\n                    price: true\n                }\n            })\n        ]);\n        const filters = {\n            categories,\n            brands,\n            priceRange: {\n                min: Number(priceRange._min.price) || 0,\n                max: Number(priceRange._max.price) || 10000\n            },\n            spiceLevels: [\n                0,\n                1,\n                2,\n                3,\n                4,\n                5\n            ],\n            storageTypes: [\n                'frozen',\n                'refrigerated',\n                'ambient'\n            ]\n        };\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            data: {\n                products: productsWithRating,\n                pagination,\n                filters\n            }\n        }, {\n            headers\n        });\n    } catch (error) {\n        console.error('Products API error:', error);\n        if (error instanceof zod__WEBPACK_IMPORTED_MODULE_4__.ZodError) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: 'Invalid query parameters',\n                details: error.errors\n            }, {\n                status: 400,\n                headers: (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getSecurityHeaders)()\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: 'サーバーエラーが発生しました'\n        }, {\n            status: 500,\n            headers: (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getSecurityHeaders)()\n        });\n    }\n}\n// 商品詳細取得（IDまたはSLUG指定）\nasync function POST(request) {\n    try {\n        const headers = (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getSecurityHeaders)();\n        const body = await request.json();\n        const { id, slug } = body;\n        if (!id && !slug) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: 'IDまたはスラッグが必要です'\n            }, {\n                status: 400,\n                headers\n            });\n        }\n        const where = id ? {\n            id\n        } : {\n            sku: slug\n        };\n        const product = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.product.findUnique({\n            where,\n            include: {\n                category: {\n                    select: {\n                        id: true,\n                        nameJa: true,\n                        nameVi: true,\n                        slug: true,\n                        parent: {\n                            select: {\n                                id: true,\n                                nameJa: true,\n                                nameVi: true,\n                                slug: true\n                            }\n                        }\n                    }\n                },\n                brand: {\n                    select: {\n                        id: true,\n                        name: true,\n                        slug: true,\n                        descriptionJa: true,\n                        descriptionVi: true,\n                        logoUrl: true,\n                        countryOrigin: true\n                    }\n                },\n                images: {\n                    orderBy: {\n                        sortOrder: 'asc'\n                    }\n                },\n                variants: {\n                    where: {\n                        isActive: true\n                    },\n                    orderBy: {\n                        name: 'asc'\n                    }\n                },\n                reviews: {\n                    where: {\n                        isApproved: true\n                    },\n                    include: {\n                        user: {\n                            select: {\n                                firstName: true,\n                                lastName: true,\n                                avatarUrl: true\n                            }\n                        }\n                    },\n                    orderBy: {\n                        createdAt: 'desc'\n                    },\n                    take: 10\n                }\n            }\n        });\n        if (!product || !product.isActive) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: '商品が見つかりません'\n            }, {\n                status: 404,\n                headers\n            });\n        }\n        // レビュー統計を計算\n        const ratings = product.reviews.map((r)=>r.rating);\n        const averageRating = ratings.length > 0 ? ratings.reduce((sum, rating)=>sum + rating, 0) / ratings.length : 0;\n        const ratingDistribution = [\n            1,\n            2,\n            3,\n            4,\n            5\n        ].map((star)=>({\n                star,\n                count: ratings.filter((r)=>r === star).length\n            }));\n        // 関連商品を取得\n        const relatedProducts = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.product.findMany({\n            where: {\n                categoryId: product.categoryId,\n                id: {\n                    not: product.id\n                },\n                isActive: true\n            },\n            include: {\n                images: {\n                    take: 1,\n                    orderBy: {\n                        sortOrder: 'asc'\n                    }\n                }\n            },\n            take: 4,\n            orderBy: {\n                createdAt: 'desc'\n            }\n        });\n        const productWithStats = {\n            ...product,\n            averageRating: Math.round(averageRating * 10) / 10,\n            reviewCount: ratings.length,\n            ratingDistribution,\n            relatedProducts\n        };\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            data: {\n                product: productWithStats\n            }\n        }, {\n            headers\n        });\n    } catch (error) {\n        console.error('Product detail API error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: 'サーバーエラーが発生しました'\n        }, {\n            status: 500,\n            headers: (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getSecurityHeaders)()\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQUUsT0FBTytFLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDZCQUE2QkE7UUFDM0MsT0FBT2hILHFEQUFZQSxDQUFDNkcsSUFBSSxDQUN0QjtZQUFFQyxTQUFTO1lBQU9FLE9BQU87UUFBaUIsR0FDMUM7WUFBRUssUUFBUTtZQUFLcEYsU0FBUzlCLDZEQUFrQkE7UUFBRztJQUVqRDtBQUNGIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXHRodXl0aWVuLm5ndXllbi5TWVNURU0tRVhFXFxEZXNrdG9wXFwwNzAyXFx2aWV0bmFtZXNlLWVjb21tZXJjZVxcc3JjXFxhcHBcXGFwaVxccHJvZHVjdHNcXHJvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcclxuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCdcclxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnQC9saWIvcHJpc21hJ1xyXG5pbXBvcnQgeyBnZXRTZWN1cml0eUhlYWRlcnMgfSBmcm9tICdAL2xpYi9hdXRoJ1xyXG5cclxuLy8g44Kv44Ko44Oq44OR44Op44Oh44O844K/44Gu44OQ44Oq44OH44O844K344On44Oz44K544Kt44O844OeXHJcbmNvbnN0IHByb2R1Y3RRdWVyeVNjaGVtYSA9IHoub2JqZWN0KHtcclxuICBwYWdlOiB6LnN0cmluZygpLm9wdGlvbmFsKCkudHJhbnNmb3JtKHZhbCA9PiB2YWwgPyBwYXJzZUludCh2YWwpIDogMSksXHJcbiAgbGltaXQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKS50cmFuc2Zvcm0odmFsID0+IHZhbCA/IHBhcnNlSW50KHZhbCkgOiAxMiksXHJcbiAgY2F0ZWdvcnk6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcclxuICBicmFuZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxyXG4gIHNlYXJjaDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxyXG4gIG1pblByaWNlOiB6LnN0cmluZygpLm9wdGlvbmFsKCkudHJhbnNmb3JtKHZhbCA9PiB2YWwgPyBwYXJzZUZsb2F0KHZhbCkgOiB1bmRlZmluZWQpLFxyXG4gIG1heFByaWNlOiB6LnN0cmluZygpLm9wdGlvbmFsKCkudHJhbnNmb3JtKHZhbCA9PiB2YWwgPyBwYXJzZUZsb2F0KHZhbCkgOiB1bmRlZmluZWQpLFxyXG4gIHNwaWNlTGV2ZWw6IHouc3RyaW5nKCkub3B0aW9uYWwoKS50cmFuc2Zvcm0odmFsID0+IHZhbCA/IHZhbC5zcGxpdCgnLCcpLm1hcChOdW1iZXIpIDogdW5kZWZpbmVkKSxcclxuICBzdG9yYWdlVHlwZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLnRyYW5zZm9ybSh2YWwgPT4gdmFsID8gdmFsLnNwbGl0KCcsJykgOiB1bmRlZmluZWQpLFxyXG4gIGluU3RvY2s6IHouc3RyaW5nKCkub3B0aW9uYWwoKS50cmFuc2Zvcm0odmFsID0+IHZhbCA9PT0gJ3RydWUnKSxcclxuICBmZWF0dXJlZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLnRyYW5zZm9ybSh2YWwgPT4gdmFsID09PSAndHJ1ZScpLFxyXG4gIHNvcnRCeTogei5lbnVtKFsnbmFtZScsICdwcmljZScsICdjcmVhdGVkJywgJ3BvcHVsYXJpdHknXSkub3B0aW9uYWwoKS5kZWZhdWx0KCdjcmVhdGVkJyksXHJcbiAgc29ydE9yZGVyOiB6LmVudW0oWydhc2MnLCAnZGVzYyddKS5vcHRpb25hbCgpLmRlZmF1bHQoJ2Rlc2MnKVxyXG59KVxyXG5cclxuLy8g5ZWG5ZOB5LiA6Kan5Y+W5b6XXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgaGVhZGVycyA9IGdldFNlY3VyaXR5SGVhZGVycygpXHJcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybClcclxuICAgIFxyXG4gICAgLy8g44Kv44Ko44Oq44OR44Op44Oh44O844K/44KS44Kq44OW44K444Kn44Kv44OI44Gr5aSJ5o+bXHJcbiAgICBjb25zdCBxdWVyeU9iamVjdDogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9XHJcbiAgICBzZWFyY2hQYXJhbXMuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xyXG4gICAgICBxdWVyeU9iamVjdFtrZXldID0gdmFsdWVcclxuICAgIH0pXHJcblxyXG4gICAgLy8g44OQ44Oq44OH44O844K344On44OzXHJcbiAgICBjb25zdCB2YWxpZGF0ZWRRdWVyeSA9IHByb2R1Y3RRdWVyeVNjaGVtYS5wYXJzZShxdWVyeU9iamVjdClcclxuICAgIGNvbnN0IHtcclxuICAgICAgcGFnZSxcclxuICAgICAgbGltaXQsXHJcbiAgICAgIGNhdGVnb3J5LFxyXG4gICAgICBicmFuZCxcclxuICAgICAgc2VhcmNoLFxyXG4gICAgICBtaW5QcmljZSxcclxuICAgICAgbWF4UHJpY2UsXHJcbiAgICAgIHNwaWNlTGV2ZWwsXHJcbiAgICAgIHN0b3JhZ2VUeXBlLFxyXG4gICAgICBpblN0b2NrLFxyXG4gICAgICBmZWF0dXJlZCxcclxuICAgICAgc29ydEJ5LFxyXG4gICAgICBzb3J0T3JkZXJcclxuICAgIH0gPSB2YWxpZGF0ZWRRdWVyeVxyXG5cclxuICAgIC8vIOODleOCo+ODq+OCv+ODvOadoeS7tuOCkuani+eviVxyXG4gICAgY29uc3Qgd2hlcmU6IGFueSA9IHtcclxuICAgICAgaXNBY3RpdmU6IHRydWVcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY2F0ZWdvcnkpIHtcclxuICAgICAgd2hlcmUuY2F0ZWdvcnlJZCA9IGNhdGVnb3J5XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGJyYW5kKSB7XHJcbiAgICAgIHdoZXJlLmJyYW5kSWQgPSBicmFuZFxyXG4gICAgfVxyXG5cclxuICAgIGlmIChzZWFyY2gpIHtcclxuICAgICAgd2hlcmUuT1IgPSBbXHJcbiAgICAgICAgeyBuYW1lSmE6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogJ2luc2Vuc2l0aXZlJyB9IH0sXHJcbiAgICAgICAgeyBuYW1lVmk6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogJ2luc2Vuc2l0aXZlJyB9IH0sXHJcbiAgICAgICAgeyBkZXNjcmlwdGlvbkphOiB7IGNvbnRhaW5zOiBzZWFyY2gsIG1vZGU6ICdpbnNlbnNpdGl2ZScgfSB9LFxyXG4gICAgICAgIHsgZGVzY3JpcHRpb25WaTogeyBjb250YWluczogc2VhcmNoLCBtb2RlOiAnaW5zZW5zaXRpdmUnIH0gfVxyXG4gICAgICBdXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1pblByaWNlICE9PSB1bmRlZmluZWQgfHwgbWF4UHJpY2UgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICB3aGVyZS5wcmljZSA9IHt9XHJcbiAgICAgIGlmIChtaW5QcmljZSAhPT0gdW5kZWZpbmVkKSB3aGVyZS5wcmljZS5ndGUgPSBtaW5QcmljZVxyXG4gICAgICBpZiAobWF4UHJpY2UgIT09IHVuZGVmaW5lZCkgd2hlcmUucHJpY2UubHRlID0gbWF4UHJpY2VcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc3BpY2VMZXZlbCAmJiBzcGljZUxldmVsLmxlbmd0aCA+IDApIHtcclxuICAgICAgd2hlcmUuc3BpY2VMZXZlbCA9IHsgaW46IHNwaWNlTGV2ZWwgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChzdG9yYWdlVHlwZSAmJiBzdG9yYWdlVHlwZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHdoZXJlLnN0b3JhZ2VUeXBlID0geyBpbjogc3RvcmFnZVR5cGUgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChpblN0b2NrKSB7XHJcbiAgICAgIHdoZXJlLnN0b2NrUXVhbnRpdHkgPSB7IGd0OiAwIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoZmVhdHVyZWQpIHtcclxuICAgICAgd2hlcmUuaXNGZWF0dXJlZCA9IHRydWVcclxuICAgIH1cclxuXHJcbiAgICAvLyDjgr3jg7zjg4jmnaHku7bjgpLmp4vnr4lcclxuICAgIGNvbnN0IG9yZGVyQnk6IGFueSA9IHt9XHJcbiAgICBzd2l0Y2ggKHNvcnRCeSkge1xyXG4gICAgICBjYXNlICduYW1lJzpcclxuICAgICAgICBvcmRlckJ5Lm5hbWVKYSA9IHNvcnRPcmRlclxyXG4gICAgICAgIGJyZWFrXHJcbiAgICAgIGNhc2UgJ3ByaWNlJzpcclxuICAgICAgICBvcmRlckJ5LnByaWNlID0gc29ydE9yZGVyXHJcbiAgICAgICAgYnJlYWtcclxuICAgICAgY2FzZSAnY3JlYXRlZCc6XHJcbiAgICAgICAgb3JkZXJCeS5jcmVhdGVkQXQgPSBzb3J0T3JkZXJcclxuICAgICAgICBicmVha1xyXG4gICAgICBjYXNlICdwb3B1bGFyaXR5JzpcclxuICAgICAgICAvLyDkurrmsJfluqbjga/ms6jmlofmlbDjgoTjg6zjg5Pjg6Xjg7zmlbDjgafliKTmlq3vvIjnsKHmmJPniYjvvIlcclxuICAgICAgICBvcmRlckJ5LmNyZWF0ZWRBdCA9IHNvcnRPcmRlclxyXG4gICAgICAgIGJyZWFrXHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgb3JkZXJCeS5jcmVhdGVkQXQgPSAnZGVzYydcclxuICAgIH1cclxuXHJcbiAgICAvLyDjg5rjg7zjgrjjg43jg7zjgrfjg6fjg7PoqIjnrpdcclxuICAgIGNvbnN0IHNraXAgPSAocGFnZSAtIDEpICogbGltaXRcclxuXHJcbiAgICAvLyDllYblk4Hjg4fjg7zjgr/lj5blvpdcclxuICAgIGNvbnN0IFtwcm9kdWN0cywgdG90YWxDb3VudF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgIHByaXNtYS5wcm9kdWN0LmZpbmRNYW55KHtcclxuICAgICAgICB3aGVyZSxcclxuICAgICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgICBjYXRlZ29yeToge1xyXG4gICAgICAgICAgICBzZWxlY3Q6IHtcclxuICAgICAgICAgICAgICBpZDogdHJ1ZSxcclxuICAgICAgICAgICAgICBuYW1lSmE6IHRydWUsXHJcbiAgICAgICAgICAgICAgbmFtZVZpOiB0cnVlLFxyXG4gICAgICAgICAgICAgIHNsdWc6IHRydWVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGJyYW5kOiB7XHJcbiAgICAgICAgICAgIHNlbGVjdDoge1xyXG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxyXG4gICAgICAgICAgICAgIG5hbWU6IHRydWUsXHJcbiAgICAgICAgICAgICAgc2x1ZzogdHJ1ZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgaW1hZ2VzOiB7XHJcbiAgICAgICAgICAgIG9yZGVyQnk6IHsgc29ydE9yZGVyOiAnYXNjJyB9LFxyXG4gICAgICAgICAgICB0YWtlOiAzXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgdmFyaWFudHM6IHtcclxuICAgICAgICAgICAgd2hlcmU6IHsgaXNBY3RpdmU6IHRydWUgfSxcclxuICAgICAgICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgICAgICAgaWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcclxuICAgICAgICAgICAgICB2YWx1ZTogdHJ1ZSxcclxuICAgICAgICAgICAgICBwcmljZU1vZGlmaWVyOiB0cnVlLFxyXG4gICAgICAgICAgICAgIHN0b2NrUXVhbnRpdHk6IHRydWVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHJldmlld3M6IHtcclxuICAgICAgICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgICAgICAgcmF0aW5nOiB0cnVlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIG9yZGVyQnksXHJcbiAgICAgICAgc2tpcCxcclxuICAgICAgICB0YWtlOiBsaW1pdFxyXG4gICAgICB9KSxcclxuICAgICAgcHJpc21hLnByb2R1Y3QuY291bnQoeyB3aGVyZSB9KVxyXG4gICAgXSlcclxuXHJcbiAgICAvLyDjg6zjg5Pjg6Xjg7zlubPlnYfoqZXkvqHjgpLoqIjnrpdcclxuICAgIGNvbnN0IHByb2R1Y3RzV2l0aFJhdGluZyA9IHByb2R1Y3RzLm1hcCgocHJvZHVjdDogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IHJhdGluZ3MgPSBwcm9kdWN0LnJldmlld3MubWFwKChyOiBhbnkpID0+IHIucmF0aW5nKVxyXG4gICAgICBjb25zdCBhdmVyYWdlUmF0aW5nID0gcmF0aW5ncy5sZW5ndGggPiAwXHJcbiAgICAgICAgPyByYXRpbmdzLnJlZHVjZSgoc3VtOiBudW1iZXIsIHJhdGluZzogbnVtYmVyKSA9PiBzdW0gKyByYXRpbmcsIDApIC8gcmF0aW5ncy5sZW5ndGhcclxuICAgICAgICA6IDBcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgLi4ucHJvZHVjdCxcclxuICAgICAgICBhdmVyYWdlUmF0aW5nOiBNYXRoLnJvdW5kKGF2ZXJhZ2VSYXRpbmcgKiAxMCkgLyAxMCxcclxuICAgICAgICByZXZpZXdDb3VudDogcmF0aW5ncy5sZW5ndGgsXHJcbiAgICAgICAgcmV2aWV3czogdW5kZWZpbmVkIC8vIOODrOODk+ODpeODvOips+e0sOOBr+mZpOWkllxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIC8vIOODmuODvOOCuOODjeODvOOCt+ODp+ODs+aDheWgsVxyXG4gICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbENvdW50IC8gbGltaXQpXHJcbiAgICBjb25zdCBwYWdpbmF0aW9uID0ge1xyXG4gICAgICBjdXJyZW50UGFnZTogcGFnZSxcclxuICAgICAgdG90YWxQYWdlcyxcclxuICAgICAgdG90YWxDb3VudCxcclxuICAgICAgaGFzTmV4dDogcGFnZSA8IHRvdGFsUGFnZXMsXHJcbiAgICAgIGhhc1ByZXY6IHBhZ2UgPiAxLFxyXG4gICAgICBsaW1pdFxyXG4gICAgfVxyXG5cclxuICAgIC8vIOODleOCo+ODq+OCv+ODvOeUqOOBruODoeOCv+ODh+ODvOOCv+OCkuWPluW+l1xyXG4gICAgY29uc3QgW2NhdGVnb3JpZXMsIGJyYW5kcywgcHJpY2VSYW5nZV0gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgIHByaXNtYS5jYXRlZ29yeS5maW5kTWFueSh7XHJcbiAgICAgICAgd2hlcmU6IHsgaXNBY3RpdmU6IHRydWUgfSxcclxuICAgICAgICBzZWxlY3Q6IHtcclxuICAgICAgICAgIGlkOiB0cnVlLFxyXG4gICAgICAgICAgbmFtZUphOiB0cnVlLFxyXG4gICAgICAgICAgbmFtZVZpOiB0cnVlLFxyXG4gICAgICAgICAgc2x1ZzogdHJ1ZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3JkZXJCeTogeyBzb3J0T3JkZXI6ICdhc2MnIH1cclxuICAgICAgfSksXHJcbiAgICAgIHByaXNtYS5icmFuZC5maW5kTWFueSh7XHJcbiAgICAgICAgd2hlcmU6IHsgaXNBY3RpdmU6IHRydWUgfSxcclxuICAgICAgICBzZWxlY3Q6IHtcclxuICAgICAgICAgIGlkOiB0cnVlLFxyXG4gICAgICAgICAgbmFtZTogdHJ1ZSxcclxuICAgICAgICAgIHNsdWc6IHRydWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9yZGVyQnk6IHsgbmFtZTogJ2FzYycgfVxyXG4gICAgICB9KSxcclxuICAgICAgcHJpc21hLnByb2R1Y3QuYWdncmVnYXRlKHtcclxuICAgICAgICB3aGVyZTogeyBpc0FjdGl2ZTogdHJ1ZSB9LFxyXG4gICAgICAgIF9taW46IHsgcHJpY2U6IHRydWUgfSxcclxuICAgICAgICBfbWF4OiB7IHByaWNlOiB0cnVlIH1cclxuICAgICAgfSlcclxuICAgIF0pXHJcblxyXG4gICAgY29uc3QgZmlsdGVycyA9IHtcclxuICAgICAgY2F0ZWdvcmllcyxcclxuICAgICAgYnJhbmRzLFxyXG4gICAgICBwcmljZVJhbmdlOiB7XHJcbiAgICAgICAgbWluOiBOdW1iZXIocHJpY2VSYW5nZS5fbWluLnByaWNlKSB8fCAwLFxyXG4gICAgICAgIG1heDogTnVtYmVyKHByaWNlUmFuZ2UuX21heC5wcmljZSkgfHwgMTAwMDBcclxuICAgICAgfSxcclxuICAgICAgc3BpY2VMZXZlbHM6IFswLCAxLCAyLCAzLCA0LCA1XSxcclxuICAgICAgc3RvcmFnZVR5cGVzOiBbJ2Zyb3plbicsICdyZWZyaWdlcmF0ZWQnLCAnYW1iaWVudCddXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIHByb2R1Y3RzOiBwcm9kdWN0c1dpdGhSYXRpbmcsXHJcbiAgICAgICAgcGFnaW5hdGlvbixcclxuICAgICAgICBmaWx0ZXJzXHJcbiAgICAgIH1cclxuICAgIH0sIHsgaGVhZGVycyB9KVxyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignUHJvZHVjdHMgQVBJIGVycm9yOicsIGVycm9yKVxyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgcXVlcnkgcGFyYW1ldGVycycsIGRldGFpbHM6IGVycm9yLmVycm9ycyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDAsIGhlYWRlcnM6IGdldFNlY3VyaXR5SGVhZGVycygpIH1cclxuICAgICAgKVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICfjgrXjg7zjg5Djg7zjgqjjg6njg7zjgYznmbrnlJ/jgZfjgb7jgZfjgZ8nIH0sXHJcbiAgICAgIHsgc3RhdHVzOiA1MDAsIGhlYWRlcnM6IGdldFNlY3VyaXR5SGVhZGVycygpIH1cclxuICAgIClcclxuICB9XHJcbn1cclxuXHJcbi8vIOWVhuWTgeips+e0sOWPluW+l++8iElE44G+44Gf44GvU0xVR+aMh+Wumu+8iVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBoZWFkZXJzID0gZ2V0U2VjdXJpdHlIZWFkZXJzKClcclxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxyXG4gICAgY29uc3QgeyBpZCwgc2x1ZyB9ID0gYm9keVxyXG5cclxuICAgIGlmICghaWQgJiYgIXNsdWcpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSUTjgb7jgZ/jga/jgrnjg6njg4PjgrDjgYzlv4XopoHjgafjgZknIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCwgaGVhZGVycyB9XHJcbiAgICAgIClcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB3aGVyZSA9IGlkID8geyBpZCB9IDogeyBza3U6IHNsdWcgfVxyXG5cclxuICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBwcmlzbWEucHJvZHVjdC5maW5kVW5pcXVlKHtcclxuICAgICAgd2hlcmUsXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBjYXRlZ29yeToge1xyXG4gICAgICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgICAgIGlkOiB0cnVlLFxyXG4gICAgICAgICAgICBuYW1lSmE6IHRydWUsXHJcbiAgICAgICAgICAgIG5hbWVWaTogdHJ1ZSxcclxuICAgICAgICAgICAgc2x1ZzogdHJ1ZSxcclxuICAgICAgICAgICAgcGFyZW50OiB7XHJcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIG5hbWVKYTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIG5hbWVWaTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHNsdWc6IHRydWVcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGJyYW5kOiB7XHJcbiAgICAgICAgICBzZWxlY3Q6IHtcclxuICAgICAgICAgICAgaWQ6IHRydWUsXHJcbiAgICAgICAgICAgIG5hbWU6IHRydWUsXHJcbiAgICAgICAgICAgIHNsdWc6IHRydWUsXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uSmE6IHRydWUsXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uVmk6IHRydWUsXHJcbiAgICAgICAgICAgIGxvZ29Vcmw6IHRydWUsXHJcbiAgICAgICAgICAgIGNvdW50cnlPcmlnaW46IHRydWVcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGltYWdlczoge1xyXG4gICAgICAgICAgb3JkZXJCeTogeyBzb3J0T3JkZXI6ICdhc2MnIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHZhcmlhbnRzOiB7XHJcbiAgICAgICAgICB3aGVyZTogeyBpc0FjdGl2ZTogdHJ1ZSB9LFxyXG4gICAgICAgICAgb3JkZXJCeTogeyBuYW1lOiAnYXNjJyB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICByZXZpZXdzOiB7XHJcbiAgICAgICAgICB3aGVyZTogeyBpc0FwcHJvdmVkOiB0cnVlIH0sXHJcbiAgICAgICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgICAgIHVzZXI6IHtcclxuICAgICAgICAgICAgICBzZWxlY3Q6IHtcclxuICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiB0cnVlXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxyXG4gICAgICAgICAgdGFrZTogMTBcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgaWYgKCFwcm9kdWN0IHx8ICFwcm9kdWN0LmlzQWN0aXZlKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ+WVhuWTgeOBjOimi+OBpOOBi+OCiuOBvuOBm+OCkycgfSxcclxuICAgICAgICB7IHN0YXR1czogNDA0LCBoZWFkZXJzIH1cclxuICAgICAgKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOODrOODk+ODpeODvOe1seioiOOCkuioiOeul1xyXG4gICAgY29uc3QgcmF0aW5ncyA9IHByb2R1Y3QucmV2aWV3cy5tYXAoKHI6IGFueSkgPT4gci5yYXRpbmcpXHJcbiAgICBjb25zdCBhdmVyYWdlUmF0aW5nID0gcmF0aW5ncy5sZW5ndGggPiAwXHJcbiAgICAgID8gcmF0aW5ncy5yZWR1Y2UoKHN1bTogbnVtYmVyLCByYXRpbmc6IG51bWJlcikgPT4gc3VtICsgcmF0aW5nLCAwKSAvIHJhdGluZ3MubGVuZ3RoXHJcbiAgICAgIDogMFxyXG5cclxuICAgIGNvbnN0IHJhdGluZ0Rpc3RyaWJ1dGlvbiA9IFsxLCAyLCAzLCA0LCA1XS5tYXAoc3RhciA9PiAoe1xyXG4gICAgICBzdGFyLFxyXG4gICAgICBjb3VudDogcmF0aW5ncy5maWx0ZXIoKHI6IG51bWJlcikgPT4gciA9PT0gc3RhcikubGVuZ3RoXHJcbiAgICB9KSlcclxuXHJcbiAgICAvLyDplqLpgKPllYblk4HjgpLlj5blvpdcclxuICAgIGNvbnN0IHJlbGF0ZWRQcm9kdWN0cyA9IGF3YWl0IHByaXNtYS5wcm9kdWN0LmZpbmRNYW55KHtcclxuICAgICAgd2hlcmU6IHtcclxuICAgICAgICBjYXRlZ29yeUlkOiBwcm9kdWN0LmNhdGVnb3J5SWQsXHJcbiAgICAgICAgaWQ6IHsgbm90OiBwcm9kdWN0LmlkIH0sXHJcbiAgICAgICAgaXNBY3RpdmU6IHRydWVcclxuICAgICAgfSxcclxuICAgICAgaW5jbHVkZToge1xyXG4gICAgICAgIGltYWdlczoge1xyXG4gICAgICAgICAgdGFrZTogMSxcclxuICAgICAgICAgIG9yZGVyQnk6IHsgc29ydE9yZGVyOiAnYXNjJyB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICB0YWtlOiA0LFxyXG4gICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH1cclxuICAgIH0pXHJcblxyXG4gICAgY29uc3QgcHJvZHVjdFdpdGhTdGF0cyA9IHtcclxuICAgICAgLi4ucHJvZHVjdCxcclxuICAgICAgYXZlcmFnZVJhdGluZzogTWF0aC5yb3VuZChhdmVyYWdlUmF0aW5nICogMTApIC8gMTAsXHJcbiAgICAgIHJldmlld0NvdW50OiByYXRpbmdzLmxlbmd0aCxcclxuICAgICAgcmF0aW5nRGlzdHJpYnV0aW9uLFxyXG4gICAgICByZWxhdGVkUHJvZHVjdHNcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBkYXRhOiB7IHByb2R1Y3Q6IHByb2R1Y3RXaXRoU3RhdHMgfVxyXG4gICAgfSwgeyBoZWFkZXJzIH0pXHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdQcm9kdWN0IGRldGFpbCBBUEkgZXJyb3I6JywgZXJyb3IpXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAn44K144O844OQ44O844Ko44Op44O844GM55m655Sf44GX44G+44GX44GfJyB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwLCBoZWFkZXJzOiBnZXRTZWN1cml0eUhlYWRlcnMoKSB9XHJcbiAgICApXHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInoiLCJwcmlzbWEiLCJnZXRTZWN1cml0eUhlYWRlcnMiLCJwcm9kdWN0UXVlcnlTY2hlbWEiLCJvYmplY3QiLCJwYWdlIiwic3RyaW5nIiwib3B0aW9uYWwiLCJ0cmFuc2Zvcm0iLCJ2YWwiLCJwYXJzZUludCIsImxpbWl0IiwiY2F0ZWdvcnkiLCJicmFuZCIsInNlYXJjaCIsIm1pblByaWNlIiwicGFyc2VGbG9hdCIsInVuZGVmaW5lZCIsIm1heFByaWNlIiwic3BpY2VMZXZlbCIsInNwbGl0IiwibWFwIiwiTnVtYmVyIiwic3RvcmFnZVR5cGUiLCJpblN0b2NrIiwiZmVhdHVyZWQiLCJzb3J0QnkiLCJlbnVtIiwiZGVmYXVsdCIsInNvcnRPcmRlciIsIkdFVCIsInJlcXVlc3QiLCJoZWFkZXJzIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwicXVlcnlPYmplY3QiLCJmb3JFYWNoIiwidmFsdWUiLCJrZXkiLCJ2YWxpZGF0ZWRRdWVyeSIsInBhcnNlIiwid2hlcmUiLCJpc0FjdGl2ZSIsImNhdGVnb3J5SWQiLCJicmFuZElkIiwiT1IiLCJuYW1lSmEiLCJjb250YWlucyIsIm1vZGUiLCJuYW1lVmkiLCJkZXNjcmlwdGlvbkphIiwiZGVzY3JpcHRpb25WaSIsInByaWNlIiwiZ3RlIiwibHRlIiwibGVuZ3RoIiwiaW4iLCJzdG9ja1F1YW50aXR5IiwiZ3QiLCJpc0ZlYXR1cmVkIiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsInNraXAiLCJwcm9kdWN0cyIsInRvdGFsQ291bnQiLCJQcm9taXNlIiwiYWxsIiwicHJvZHVjdCIsImZpbmRNYW55IiwiaW5jbHVkZSIsInNlbGVjdCIsImlkIiwic2x1ZyIsIm5hbWUiLCJpbWFnZXMiLCJ0YWtlIiwidmFyaWFudHMiLCJwcmljZU1vZGlmaWVyIiwicmV2aWV3cyIsInJhdGluZyIsImNvdW50IiwicHJvZHVjdHNXaXRoUmF0aW5nIiwicmF0aW5ncyIsInIiLCJhdmVyYWdlUmF0aW5nIiwicmVkdWNlIiwic3VtIiwiTWF0aCIsInJvdW5kIiwicmV2aWV3Q291bnQiLCJ0b3RhbFBhZ2VzIiwiY2VpbCIsInBhZ2luYXRpb24iLCJjdXJyZW50UGFnZSIsImhhc05leHQiLCJoYXNQcmV2IiwiY2F0ZWdvcmllcyIsImJyYW5kcyIsInByaWNlUmFuZ2UiLCJhZ2dyZWdhdGUiLCJfbWluIiwiX21heCIsImZpbHRlcnMiLCJtaW4iLCJtYXgiLCJzcGljZUxldmVscyIsInN0b3JhZ2VUeXBlcyIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsImVycm9yIiwiY29uc29sZSIsIlpvZEVycm9yIiwiZGV0YWlscyIsImVycm9ycyIsInN0YXR1cyIsIlBPU1QiLCJib2R5Iiwic2t1IiwiZmluZFVuaXF1ZSIsInBhcmVudCIsImxvZ29VcmwiLCJjb3VudHJ5T3JpZ2luIiwiaXNBcHByb3ZlZCIsInVzZXIiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsImF2YXRhclVybCIsInJhdGluZ0Rpc3RyaWJ1dGlvbiIsInN0YXIiLCJmaWx0ZXIiLCJyZWxhdGVkUHJvZHVjdHMiLCJub3QiLCJwcm9kdWN0V2l0aFN0YXRzIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/products/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkRateLimit: () => (/* binding */ checkRateLimit),\n/* harmony export */   generateToken: () => (/* binding */ generateToken),\n/* harmony export */   getAuthenticatedAdmin: () => (/* binding */ getAuthenticatedAdmin),\n/* harmony export */   getAuthenticatedUser: () => (/* binding */ getAuthenticatedUser),\n/* harmony export */   getSecurityHeaders: () => (/* binding */ getSecurityHeaders),\n/* harmony export */   getTokenFromRequest: () => (/* binding */ getTokenFromRequest),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   isValidEmail: () => (/* binding */ isValidEmail),\n/* harmony export */   isValidPassword: () => (/* binding */ isValidPassword),\n/* harmony export */   sanitizeInput: () => (/* binding */ sanitizeInput),\n/* harmony export */   verifyAdminAuth: () => (/* binding */ verifyAdminAuth),\n/* harmony export */   verifyAuth: () => (/* binding */ verifyAuth),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword),\n/* harmony export */   verifyToken: () => (/* binding */ verifyToken)\n/* harmony export */ });\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ \"(rsc)/./node_modules/jsonwebtoken/index.js\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./src/lib/prisma.ts\");\n\n\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'fallback-secret-key';\nconst JWT_EXPIRES_IN = '7d';\n// パスワードハッシュ化\nasync function hashPassword(password) {\n    const saltRounds = 12;\n    return await bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].hash(password, saltRounds);\n}\n// パスワード検証\nasync function verifyPassword(password, hashedPassword) {\n    return await bcryptjs__WEBPACK_IMPORTED_MODULE_0__[\"default\"].compare(password, hashedPassword);\n}\n// JWTトークン生成\nfunction generateToken(payload) {\n    return jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().sign(payload, JWT_SECRET, {\n        expiresIn: JWT_EXPIRES_IN\n    });\n}\n// JWTトークン検証\nfunction verifyToken(token) {\n    try {\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(token, JWT_SECRET);\n        return {\n            userId: decoded.userId,\n            email: decoded.email,\n            role: decoded.role\n        };\n    } catch (error) {\n        return null;\n    }\n}\n// リクエストからトークンを取得\nfunction getTokenFromRequest(request) {\n    // Authorization ヘッダーから取得\n    const authHeader = request.headers.get('authorization');\n    if (authHeader && authHeader.startsWith('Bearer ')) {\n        return authHeader.substring(7);\n    }\n    // Cookieから取得\n    const token = request.cookies.get('auth-token')?.value;\n    return token || null;\n}\n// 認証されたユーザー情報を取得\nasync function getAuthenticatedUser(request) {\n    const token = getTokenFromRequest(request);\n    if (!token) return null;\n    const decoded = verifyToken(token);\n    if (!decoded) return null;\n    try {\n        const user = await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.findUnique({\n            where: {\n                id: decoded.userId\n            },\n            select: {\n                id: true,\n                email: true,\n                firstName: true,\n                lastName: true,\n                preferredLanguage: true,\n                avatarUrl: true,\n                isActive: true\n            }\n        });\n        if (!user || !user.isActive) return null;\n        return {\n            id: user.id,\n            email: user.email,\n            firstName: user.firstName,\n            lastName: user.lastName,\n            preferredLanguage: user.preferredLanguage,\n            avatarUrl: user.avatarUrl\n        };\n    } catch (error) {\n        console.error('Error fetching authenticated user:', error);\n        return null;\n    }\n}\n// 認証チェック（成功/失敗の結果を返す）\nasync function verifyAuth(request) {\n    try {\n        const user = await getAuthenticatedUser(request);\n        if (!user) {\n            return {\n                success: false,\n                error: '認証が必要です'\n            };\n        }\n        return {\n            success: true,\n            user\n        };\n    } catch (error) {\n        console.error('Auth verification error:', error);\n        return {\n            success: false,\n            error: '認証エラーが発生しました'\n        };\n    }\n}\n// 管理者認証チェック\nasync function verifyAdminAuth(request) {\n    try {\n        const admin = await getAuthenticatedAdmin(request);\n        if (!admin) {\n            return {\n                success: false,\n                error: '管理者認証が必要です'\n            };\n        }\n        return {\n            success: true,\n            admin\n        };\n    } catch (error) {\n        console.error('Admin auth verification error:', error);\n        return {\n            success: false,\n            error: '管理者認証エラーが発生しました'\n        };\n    }\n}\n// 管理者認証\nasync function getAuthenticatedAdmin(request) {\n    const token = getTokenFromRequest(request);\n    if (!token) return null;\n    const decoded = verifyToken(token);\n    if (!decoded || decoded.role !== 'admin') return null;\n    try {\n        const admin = await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.admin.findUnique({\n            where: {\n                id: decoded.userId\n            },\n            select: {\n                id: true,\n                email: true,\n                name: true,\n                role: true,\n                permissions: true,\n                isActive: true\n            }\n        });\n        if (!admin || !admin.isActive) return null;\n        return admin;\n    } catch (error) {\n        console.error('Error fetching authenticated admin:', error);\n        return null;\n    }\n}\n// 入力値のサニタイゼーション\nfunction sanitizeInput(input) {\n    return input.trim().replace(/[<>]/g, '');\n}\n// メールアドレスの検証\nfunction isValidEmail(email) {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n}\n// パスワード強度の検証\nfunction isValidPassword(password) {\n    if (password.length < 8) {\n        return {\n            valid: false,\n            message: 'パスワードは8文字以上である必要があります'\n        };\n    }\n    if (!/(?=.*[a-z])/.test(password)) {\n        return {\n            valid: false,\n            message: 'パスワードには小文字を含める必要があります'\n        };\n    }\n    if (!/(?=.*[A-Z])/.test(password)) {\n        return {\n            valid: false,\n            message: 'パスワードには大文字を含める必要があります'\n        };\n    }\n    if (!/(?=.*\\d)/.test(password)) {\n        return {\n            valid: false,\n            message: 'パスワードには数字を含める必要があります'\n        };\n    }\n    return {\n        valid: true\n    };\n}\n// レート制限チェック（簡易版）\nconst rateLimitMap = new Map();\nfunction checkRateLimit(identifier, maxAttempts = 5, windowMs = 15 * 60 * 1000) {\n    const now = Date.now();\n    const record = rateLimitMap.get(identifier);\n    if (!record || now > record.resetTime) {\n        rateLimitMap.set(identifier, {\n            count: 1,\n            resetTime: now + windowMs\n        });\n        return true;\n    }\n    if (record.count >= maxAttempts) {\n        return false;\n    }\n    record.count++;\n    return true;\n}\n// セキュリティヘッダーの設定\nfunction getSecurityHeaders() {\n    return {\n        'X-Content-Type-Options': 'nosniff',\n        'X-Frame-Options': 'DENY',\n        'X-XSS-Protection': '1; mode=block',\n        'Referrer-Policy': 'strict-origin-when-cross-origin',\n        'Content-Security-Policy': \"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:;\"\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQTZCO0FBQ0M7QUFFRztBQUdqQyxNQUFNRyxhQUFhQyxRQUFRQyxHQUFHLENBQUNGLFVBQVUsSUFBSTtBQUM3QyxNQUFNRyxpQkFBaUI7QUFFdkIsYUFBYTtBQUNOLGVBQWVDLGFBQWFDLFFBQWdCO0lBQ2pELE1BQU1DLGFBQWE7SUFDbkIsT0FBTyxNQUFNVCxxREFBVyxDQUFDUSxVQUFVQztBQUNyQztBQUVBLFVBQVU7QUFDSCxlQUFlRSxlQUFlSCxRQUFnQixFQUFFSSxjQUFzQjtJQUMzRSxPQUFPLE1BQU1aLHdEQUFjLENBQUNRLFVBQVVJO0FBQ3hDO0FBRUEsWUFBWTtBQUNMLFNBQVNFLGNBQWNDLE9BQXlEO0lBQ3JGLE9BQU9kLHdEQUFRLENBQUNjLFNBQVNaLFlBQVk7UUFBRWMsV0FBV1g7SUFBZTtBQUNuRTtBQUVBLFlBQVk7QUFDTCxTQUFTWSxZQUFZQyxLQUFhO0lBQ3ZDLElBQUk7UUFDRixNQUFNQyxVQUFVbkIsMERBQVUsQ0FBQ2tCLE9BQU9oQjtRQUNsQyxPQUFPO1lBQ0xtQixRQUFRRixRQUFRRSxNQUFNO1lBQ3RCQyxPQUFPSCxRQUFRRyxLQUFLO1lBQ3BCQyxNQUFNSixRQUFRSSxJQUFJO1FBQ3BCO0lBQ0YsRUFBRSxPQUFPQyxPQUFPO1FBQ2QsT0FBTztJQUNUO0FBQ0Y7QUFFQSxpQkFBaUI7QUFDVixTQUFTQyxvQkFBb0JDLE9BQW9CO0lBQ3RELHlCQUF5QjtJQUN6QixNQUFNQyxhQUFhRCxRQUFRRSxPQUFPLENBQUNDLEdBQUcsQ0FBQztJQUN2QyxJQUFJRixjQUFjQSxXQUFXRyxVQUFVLENBQUMsWUFBWTtRQUNsRCxPQUFPSCxXQUFXSSxTQUFTLENBQUM7SUFDOUI7SUFFQSxhQUFhO0lBQ2IsTUFBTWIsUUFBUVEsUUFBUU0sT0FBTyxDQUFDSCxHQUFHLENBQUMsZUFBZUk7SUFDakQsT0FBT2YsU0FBUztBQUNsQjtBQUVBLGlCQUFpQjtBQUNWLGVBQWVnQixxQkFBcUJSLE9BQW9CO0lBQzdELE1BQU1SLFFBQVFPLG9CQUFvQkM7SUFDbEMsSUFBSSxDQUFDUixPQUFPLE9BQU87SUFFbkIsTUFBTUMsVUFBVUYsWUFBWUM7SUFDNUIsSUFBSSxDQUFDQyxTQUFTLE9BQU87SUFFckIsSUFBSTtRQUNGLE1BQU1nQixPQUFPLE1BQU1sQywyQ0FBTUEsQ0FBQ2tDLElBQUksQ0FBQ0MsVUFBVSxDQUFDO1lBQ3hDQyxPQUFPO2dCQUFFQyxJQUFJbkIsUUFBUUUsTUFBTTtZQUFDO1lBQzVCa0IsUUFBUTtnQkFDTkQsSUFBSTtnQkFDSmhCLE9BQU87Z0JBQ1BrQixXQUFXO2dCQUNYQyxVQUFVO2dCQUNWQyxtQkFBbUI7Z0JBQ25CQyxXQUFXO2dCQUNYQyxVQUFVO1lBQ1o7UUFDRjtRQUVBLElBQUksQ0FBQ1QsUUFBUSxDQUFDQSxLQUFLUyxRQUFRLEVBQUUsT0FBTztRQUVwQyxPQUFPO1lBQ0xOLElBQUlILEtBQUtHLEVBQUU7WUFDWGhCLE9BQU9hLEtBQUtiLEtBQUs7WUFDakJrQixXQUFXTCxLQUFLSyxTQUFTO1lBQ3pCQyxVQUFVTixLQUFLTSxRQUFRO1lBQ3ZCQyxtQkFBbUJQLEtBQUtPLGlCQUFpQjtZQUN6Q0MsV0FBV1IsS0FBS1EsU0FBUztRQUMzQjtJQUNGLEVBQUUsT0FBT25CLE9BQU87UUFDZHFCLFFBQVFyQixLQUFLLENBQUMsc0NBQXNDQTtRQUNwRCxPQUFPO0lBQ1Q7QUFDRjtBQUVBLHNCQUFzQjtBQUNmLGVBQWVzQixXQUFXcEIsT0FBb0I7SUFDbkQsSUFBSTtRQUNGLE1BQU1TLE9BQU8sTUFBTUQscUJBQXFCUjtRQUN4QyxJQUFJLENBQUNTLE1BQU07WUFDVCxPQUFPO2dCQUFFWSxTQUFTO2dCQUFPdkIsT0FBTztZQUFVO1FBQzVDO1FBQ0EsT0FBTztZQUFFdUIsU0FBUztZQUFNWjtRQUFLO0lBQy9CLEVBQUUsT0FBT1gsT0FBTztRQUNkcUIsUUFBUXJCLEtBQUssQ0FBQyw0QkFBNEJBO1FBQzFDLE9BQU87WUFBRXVCLFNBQVM7WUFBT3ZCLE9BQU87UUFBZTtJQUNqRDtBQUNGO0FBRUEsWUFBWTtBQUNMLGVBQWV3QixnQkFBZ0J0QixPQUFvQjtJQUN4RCxJQUFJO1FBQ0YsTUFBTXVCLFFBQVEsTUFBTUMsc0JBQXNCeEI7UUFDMUMsSUFBSSxDQUFDdUIsT0FBTztZQUNWLE9BQU87Z0JBQUVGLFNBQVM7Z0JBQU92QixPQUFPO1lBQWE7UUFDL0M7UUFDQSxPQUFPO1lBQUV1QixTQUFTO1lBQU1FO1FBQU07SUFDaEMsRUFBRSxPQUFPekIsT0FBTztRQUNkcUIsUUFBUXJCLEtBQUssQ0FBQyxrQ0FBa0NBO1FBQ2hELE9BQU87WUFBRXVCLFNBQVM7WUFBT3ZCLE9BQU87UUFBa0I7SUFDcEQ7QUFDRjtBQUVBLFFBQVE7QUFDRCxlQUFlMEIsc0JBQXNCeEIsT0FBb0I7SUFDOUQsTUFBTVIsUUFBUU8sb0JBQW9CQztJQUNsQyxJQUFJLENBQUNSLE9BQU8sT0FBTztJQUVuQixNQUFNQyxVQUFVRixZQUFZQztJQUM1QixJQUFJLENBQUNDLFdBQVdBLFFBQVFJLElBQUksS0FBSyxTQUFTLE9BQU87SUFFakQsSUFBSTtRQUNGLE1BQU0wQixRQUFRLE1BQU1oRCwyQ0FBTUEsQ0FBQ2dELEtBQUssQ0FBQ2IsVUFBVSxDQUFDO1lBQzFDQyxPQUFPO2dCQUFFQyxJQUFJbkIsUUFBUUUsTUFBTTtZQUFDO1lBQzVCa0IsUUFBUTtnQkFDTkQsSUFBSTtnQkFDSmhCLE9BQU87Z0JBQ1A2QixNQUFNO2dCQUNONUIsTUFBTTtnQkFDTjZCLGFBQWE7Z0JBQ2JSLFVBQVU7WUFDWjtRQUNGO1FBRUEsSUFBSSxDQUFDSyxTQUFTLENBQUNBLE1BQU1MLFFBQVEsRUFBRSxPQUFPO1FBRXRDLE9BQU9LO0lBQ1QsRUFBRSxPQUFPekIsT0FBTztRQUNkcUIsUUFBUXJCLEtBQUssQ0FBQyx1Q0FBdUNBO1FBQ3JELE9BQU87SUFDVDtBQUNGO0FBRUEsZ0JBQWdCO0FBQ1QsU0FBUzZCLGNBQWNDLEtBQWE7SUFDekMsT0FBT0EsTUFBTUMsSUFBSSxHQUFHQyxPQUFPLENBQUMsU0FBUztBQUN2QztBQUVBLGFBQWE7QUFDTixTQUFTQyxhQUFhbkMsS0FBYTtJQUN4QyxNQUFNb0MsYUFBYTtJQUNuQixPQUFPQSxXQUFXQyxJQUFJLENBQUNyQztBQUN6QjtBQUVBLGFBQWE7QUFDTixTQUFTc0MsZ0JBQWdCckQsUUFBZ0I7SUFDOUMsSUFBSUEsU0FBU3NELE1BQU0sR0FBRyxHQUFHO1FBQ3ZCLE9BQU87WUFBRUMsT0FBTztZQUFPQyxTQUFTO1FBQXdCO0lBQzFEO0lBRUEsSUFBSSxDQUFDLGNBQWNKLElBQUksQ0FBQ3BELFdBQVc7UUFDakMsT0FBTztZQUFFdUQsT0FBTztZQUFPQyxTQUFTO1FBQXdCO0lBQzFEO0lBRUEsSUFBSSxDQUFDLGNBQWNKLElBQUksQ0FBQ3BELFdBQVc7UUFDakMsT0FBTztZQUFFdUQsT0FBTztZQUFPQyxTQUFTO1FBQXdCO0lBQzFEO0lBRUEsSUFBSSxDQUFDLFdBQVdKLElBQUksQ0FBQ3BELFdBQVc7UUFDOUIsT0FBTztZQUFFdUQsT0FBTztZQUFPQyxTQUFTO1FBQXVCO0lBQ3pEO0lBRUEsT0FBTztRQUFFRCxPQUFPO0lBQUs7QUFDdkI7QUFFQSxpQkFBaUI7QUFDakIsTUFBTUUsZUFBZSxJQUFJQztBQUVsQixTQUFTQyxlQUFlQyxVQUFrQixFQUFFQyxjQUFzQixDQUFDLEVBQUVDLFdBQW1CLEtBQUssS0FBSyxJQUFJO0lBQzNHLE1BQU1DLE1BQU1DLEtBQUtELEdBQUc7SUFDcEIsTUFBTUUsU0FBU1IsYUFBYW5DLEdBQUcsQ0FBQ3NDO0lBRWhDLElBQUksQ0FBQ0ssVUFBVUYsTUFBTUUsT0FBT0MsU0FBUyxFQUFFO1FBQ3JDVCxhQUFhVSxHQUFHLENBQUNQLFlBQVk7WUFBRVEsT0FBTztZQUFHRixXQUFXSCxNQUFNRDtRQUFTO1FBQ25FLE9BQU87SUFDVDtJQUVBLElBQUlHLE9BQU9HLEtBQUssSUFBSVAsYUFBYTtRQUMvQixPQUFPO0lBQ1Q7SUFFQUksT0FBT0csS0FBSztJQUNaLE9BQU87QUFDVDtBQUVBLGdCQUFnQjtBQUNULFNBQVNDO0lBQ2QsT0FBTztRQUNMLDBCQUEwQjtRQUMxQixtQkFBbUI7UUFDbkIsb0JBQW9CO1FBQ3BCLG1CQUFtQjtRQUNuQiwyQkFBMkI7SUFDN0I7QUFDRiIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFx0aHV5dGllbi5uZ3V5ZW4uU1lTVEVNLUVYRVxcRGVza3RvcFxcMDcwMlxcdmlldG5hbWVzZS1lY29tbWVyY2VcXHNyY1xcbGliXFxhdXRoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBiY3J5cHQgZnJvbSAnYmNyeXB0anMnXHJcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJ1xyXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJ1xyXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuL3ByaXNtYSdcclxuaW1wb3J0IHsgQXV0aFVzZXIgfSBmcm9tICdAL3R5cGVzJ1xyXG5cclxuY29uc3QgSldUX1NFQ1JFVCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ2ZhbGxiYWNrLXNlY3JldC1rZXknXHJcbmNvbnN0IEpXVF9FWFBJUkVTX0lOID0gJzdkJ1xyXG5cclxuLy8g44OR44K544Ov44O844OJ44OP44OD44K344Ol5YyWXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYXNoUGFzc3dvcmQocGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgY29uc3Qgc2FsdFJvdW5kcyA9IDEyXHJcbiAgcmV0dXJuIGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCBzYWx0Um91bmRzKVxyXG59XHJcblxyXG4vLyDjg5Hjgrnjg6/jg7zjg4nmpJzoqLxcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkOiBzdHJpbmcsIGhhc2hlZFBhc3N3b3JkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICByZXR1cm4gYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIGhhc2hlZFBhc3N3b3JkKVxyXG59XHJcblxyXG4vLyBKV1Tjg4jjg7zjgq/jg7PnlJ/miJBcclxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlVG9rZW4ocGF5bG9hZDogeyB1c2VySWQ6IHN0cmluZzsgZW1haWw6IHN0cmluZzsgcm9sZT86IHN0cmluZyB9KTogc3RyaW5nIHtcclxuICByZXR1cm4gand0LnNpZ24ocGF5bG9hZCwgSldUX1NFQ1JFVCwgeyBleHBpcmVzSW46IEpXVF9FWFBJUkVTX0lOIH0pXHJcbn1cclxuXHJcbi8vIEpXVOODiOODvOOCr+ODs+aknOiovFxyXG5leHBvcnQgZnVuY3Rpb24gdmVyaWZ5VG9rZW4odG9rZW46IHN0cmluZyk6IHsgdXNlcklkOiBzdHJpbmc7IGVtYWlsOiBzdHJpbmc7IHJvbGU/OiBzdHJpbmcgfSB8IG51bGwge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgSldUX1NFQ1JFVCkgYXMgYW55XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB1c2VySWQ6IGRlY29kZWQudXNlcklkLFxyXG4gICAgICBlbWFpbDogZGVjb2RlZC5lbWFpbCxcclxuICAgICAgcm9sZTogZGVjb2RlZC5yb2xlXHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBudWxsXHJcbiAgfVxyXG59XHJcblxyXG4vLyDjg6rjgq/jgqjjgrnjg4jjgYvjgonjg4jjg7zjgq/jg7PjgpLlj5blvpdcclxuZXhwb3J0IGZ1bmN0aW9uIGdldFRva2VuRnJvbVJlcXVlc3QocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBzdHJpbmcgfCBudWxsIHtcclxuICAvLyBBdXRob3JpemF0aW9uIOODmOODg+ODgOODvOOBi+OCieWPluW+l1xyXG4gIGNvbnN0IGF1dGhIZWFkZXIgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdhdXRob3JpemF0aW9uJylcclxuICBpZiAoYXV0aEhlYWRlciAmJiBhdXRoSGVhZGVyLnN0YXJ0c1dpdGgoJ0JlYXJlciAnKSkge1xyXG4gICAgcmV0dXJuIGF1dGhIZWFkZXIuc3Vic3RyaW5nKDcpXHJcbiAgfVxyXG5cclxuICAvLyBDb29raWXjgYvjgonlj5blvpdcclxuICBjb25zdCB0b2tlbiA9IHJlcXVlc3QuY29va2llcy5nZXQoJ2F1dGgtdG9rZW4nKT8udmFsdWVcclxuICByZXR1cm4gdG9rZW4gfHwgbnVsbFxyXG59XHJcblxyXG4vLyDoqo3oqLzjgZXjgozjgZ/jg6bjg7zjgrbjg7zmg4XloLHjgpLlj5blvpdcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEF1dGhlbnRpY2F0ZWRVc2VyKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTxBdXRoVXNlciB8IG51bGw+IHtcclxuICBjb25zdCB0b2tlbiA9IGdldFRva2VuRnJvbVJlcXVlc3QocmVxdWVzdClcclxuICBpZiAoIXRva2VuKSByZXR1cm4gbnVsbFxyXG5cclxuICBjb25zdCBkZWNvZGVkID0gdmVyaWZ5VG9rZW4odG9rZW4pXHJcbiAgaWYgKCFkZWNvZGVkKSByZXR1cm4gbnVsbFxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogZGVjb2RlZC51c2VySWQgfSxcclxuICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgaWQ6IHRydWUsXHJcbiAgICAgICAgZW1haWw6IHRydWUsXHJcbiAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxyXG4gICAgICAgIGxhc3ROYW1lOiB0cnVlLFxyXG4gICAgICAgIHByZWZlcnJlZExhbmd1YWdlOiB0cnVlLFxyXG4gICAgICAgIGF2YXRhclVybDogdHJ1ZSxcclxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIGlmICghdXNlciB8fCAhdXNlci5pc0FjdGl2ZSkgcmV0dXJuIG51bGxcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpZDogdXNlci5pZCxcclxuICAgICAgZW1haWw6IHVzZXIuZW1haWwsXHJcbiAgICAgIGZpcnN0TmFtZTogdXNlci5maXJzdE5hbWUsXHJcbiAgICAgIGxhc3ROYW1lOiB1c2VyLmxhc3ROYW1lLFxyXG4gICAgICBwcmVmZXJyZWRMYW5ndWFnZTogdXNlci5wcmVmZXJyZWRMYW5ndWFnZSxcclxuICAgICAgYXZhdGFyVXJsOiB1c2VyLmF2YXRhclVybFxyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBhdXRoZW50aWNhdGVkIHVzZXI6JywgZXJyb3IpXHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxufVxyXG5cclxuLy8g6KqN6Ki844OB44Kn44OD44Kv77yI5oiQ5YqfL+WkseaVl+OBrue1kOaenOOCkui/lOOBme+8iVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5QXV0aChyZXF1ZXN0OiBOZXh0UmVxdWVzdCk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyB1c2VyPzogQXV0aFVzZXI7IGVycm9yPzogc3RyaW5nIH0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGdldEF1dGhlbnRpY2F0ZWRVc2VyKHJlcXVlc3QpXHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAn6KqN6Ki844GM5b+F6KaB44Gn44GZJyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB1c2VyIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignQXV0aCB2ZXJpZmljYXRpb24gZXJyb3I6JywgZXJyb3IpXHJcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICfoqo3oqLzjgqjjg6njg7zjgYznmbrnlJ/jgZfjgb7jgZfjgZ8nIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIOeuoeeQhuiAheiqjeiovOODgeOCp+ODg+OCr1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5QWRtaW5BdXRoKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IGFkbWluPzogYW55OyBlcnJvcj86IHN0cmluZyB9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGFkbWluID0gYXdhaXQgZ2V0QXV0aGVudGljYXRlZEFkbWluKHJlcXVlc3QpXHJcbiAgICBpZiAoIWFkbWluKSB7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ+euoeeQhuiAheiqjeiovOOBjOW/heimgeOBp+OBmScgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWRtaW4gfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdBZG1pbiBhdXRoIHZlcmlmaWNhdGlvbiBlcnJvcjonLCBlcnJvcilcclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ+euoeeQhuiAheiqjeiovOOCqOODqeODvOOBjOeZuueUn+OBl+OBvuOBl+OBnycgfVxyXG4gIH1cclxufVxyXG5cclxuLy8g566h55CG6ICF6KqN6Ki8XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoZW50aWNhdGVkQWRtaW4ocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICBjb25zdCB0b2tlbiA9IGdldFRva2VuRnJvbVJlcXVlc3QocmVxdWVzdClcclxuICBpZiAoIXRva2VuKSByZXR1cm4gbnVsbFxyXG5cclxuICBjb25zdCBkZWNvZGVkID0gdmVyaWZ5VG9rZW4odG9rZW4pXHJcbiAgaWYgKCFkZWNvZGVkIHx8IGRlY29kZWQucm9sZSAhPT0gJ2FkbWluJykgcmV0dXJuIG51bGxcclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGFkbWluID0gYXdhaXQgcHJpc21hLmFkbWluLmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogZGVjb2RlZC51c2VySWQgfSxcclxuICAgICAgc2VsZWN0OiB7XHJcbiAgICAgICAgaWQ6IHRydWUsXHJcbiAgICAgICAgZW1haWw6IHRydWUsXHJcbiAgICAgICAgbmFtZTogdHJ1ZSxcclxuICAgICAgICByb2xlOiB0cnVlLFxyXG4gICAgICAgIHBlcm1pc3Npb25zOiB0cnVlLFxyXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlXHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgaWYgKCFhZG1pbiB8fCAhYWRtaW4uaXNBY3RpdmUpIHJldHVybiBudWxsXHJcblxyXG4gICAgcmV0dXJuIGFkbWluXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGF1dGhlbnRpY2F0ZWQgYWRtaW46JywgZXJyb3IpXHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxufVxyXG5cclxuLy8g5YWl5Yqb5YCk44Gu44K144OL44K/44Kk44K844O844K344On44OzXHJcbmV4cG9ydCBmdW5jdGlvbiBzYW5pdGl6ZUlucHV0KGlucHV0OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIHJldHVybiBpbnB1dC50cmltKCkucmVwbGFjZSgvWzw+XS9nLCAnJylcclxufVxyXG5cclxuLy8g44Oh44O844Or44Ki44OJ44Os44K544Gu5qSc6Ki8XHJcbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkRW1haWwoZW1haWw6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IGVtYWlsUmVnZXggPSAvXlteXFxzQF0rQFteXFxzQF0rXFwuW15cXHNAXSskL1xyXG4gIHJldHVybiBlbWFpbFJlZ2V4LnRlc3QoZW1haWwpXHJcbn1cclxuXHJcbi8vIOODkeOCueODr+ODvOODieW8t+W6puOBruaknOiovFxyXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZFBhc3N3b3JkKHBhc3N3b3JkOiBzdHJpbmcpOiB7IHZhbGlkOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nIH0ge1xyXG4gIGlmIChwYXNzd29yZC5sZW5ndGggPCA4KSB7XHJcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIG1lc3NhZ2U6ICfjg5Hjgrnjg6/jg7zjg4njga845paH5a2X5Lul5LiK44Gn44GC44KL5b+F6KaB44GM44GC44KK44G+44GZJyB9XHJcbiAgfVxyXG4gIFxyXG4gIGlmICghLyg/PS4qW2Etel0pLy50ZXN0KHBhc3N3b3JkKSkge1xyXG4gICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBtZXNzYWdlOiAn44OR44K544Ov44O844OJ44Gr44Gv5bCP5paH5a2X44KS5ZCr44KB44KL5b+F6KaB44GM44GC44KK44G+44GZJyB9XHJcbiAgfVxyXG4gIFxyXG4gIGlmICghLyg/PS4qW0EtWl0pLy50ZXN0KHBhc3N3b3JkKSkge1xyXG4gICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBtZXNzYWdlOiAn44OR44K544Ov44O844OJ44Gr44Gv5aSn5paH5a2X44KS5ZCr44KB44KL5b+F6KaB44GM44GC44KK44G+44GZJyB9XHJcbiAgfVxyXG4gIFxyXG4gIGlmICghLyg/PS4qXFxkKS8udGVzdChwYXNzd29yZCkpIHtcclxuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgbWVzc2FnZTogJ+ODkeOCueODr+ODvOODieOBq+OBr+aVsOWtl+OCkuWQq+OCgeOCi+W/heimgeOBjOOBguOCiuOBvuOBmScgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHsgdmFsaWQ6IHRydWUgfVxyXG59XHJcblxyXG4vLyDjg6zjg7zjg4jliLbpmZDjg4Hjgqfjg4Pjgq/vvIjnsKHmmJPniYjvvIlcclxuY29uc3QgcmF0ZUxpbWl0TWFwID0gbmV3IE1hcDxzdHJpbmcsIHsgY291bnQ6IG51bWJlcjsgcmVzZXRUaW1lOiBudW1iZXIgfT4oKVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXI6IHN0cmluZywgbWF4QXR0ZW1wdHM6IG51bWJlciA9IDUsIHdpbmRvd01zOiBudW1iZXIgPSAxNSAqIDYwICogMTAwMCk6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IG5vdyA9IERhdGUubm93KClcclxuICBjb25zdCByZWNvcmQgPSByYXRlTGltaXRNYXAuZ2V0KGlkZW50aWZpZXIpXHJcblxyXG4gIGlmICghcmVjb3JkIHx8IG5vdyA+IHJlY29yZC5yZXNldFRpbWUpIHtcclxuICAgIHJhdGVMaW1pdE1hcC5zZXQoaWRlbnRpZmllciwgeyBjb3VudDogMSwgcmVzZXRUaW1lOiBub3cgKyB3aW5kb3dNcyB9KVxyXG4gICAgcmV0dXJuIHRydWVcclxuICB9XHJcblxyXG4gIGlmIChyZWNvcmQuY291bnQgPj0gbWF4QXR0ZW1wdHMpIHtcclxuICAgIHJldHVybiBmYWxzZVxyXG4gIH1cclxuXHJcbiAgcmVjb3JkLmNvdW50KytcclxuICByZXR1cm4gdHJ1ZVxyXG59XHJcblxyXG4vLyDjgrvjgq3jg6Xjg6rjg4bjgqPjg5jjg4Pjg4Djg7zjga7oqK3lrppcclxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlY3VyaXR5SGVhZGVycygpIHtcclxuICByZXR1cm4ge1xyXG4gICAgJ1gtQ29udGVudC1UeXBlLU9wdGlvbnMnOiAnbm9zbmlmZicsXHJcbiAgICAnWC1GcmFtZS1PcHRpb25zJzogJ0RFTlknLFxyXG4gICAgJ1gtWFNTLVByb3RlY3Rpb24nOiAnMTsgbW9kZT1ibG9jaycsXHJcbiAgICAnUmVmZXJyZXItUG9saWN5JzogJ3N0cmljdC1vcmlnaW4td2hlbi1jcm9zcy1vcmlnaW4nLFxyXG4gICAgJ0NvbnRlbnQtU2VjdXJpdHktUG9saWN5JzogXCJkZWZhdWx0LXNyYyAnc2VsZic7IHNjcmlwdC1zcmMgJ3NlbGYnICd1bnNhZmUtaW5saW5lJyAndW5zYWZlLWV2YWwnOyBzdHlsZS1zcmMgJ3NlbGYnICd1bnNhZmUtaW5saW5lJzsgaW1nLXNyYyAnc2VsZicgZGF0YTogaHR0cHM6OyBmb250LXNyYyAnc2VsZicgZGF0YTo7XCJcclxuICB9XHJcbn0iXSwibmFtZXMiOlsiYmNyeXB0Iiwiand0IiwicHJpc21hIiwiSldUX1NFQ1JFVCIsInByb2Nlc3MiLCJlbnYiLCJKV1RfRVhQSVJFU19JTiIsImhhc2hQYXNzd29yZCIsInBhc3N3b3JkIiwic2FsdFJvdW5kcyIsImhhc2giLCJ2ZXJpZnlQYXNzd29yZCIsImhhc2hlZFBhc3N3b3JkIiwiY29tcGFyZSIsImdlbmVyYXRlVG9rZW4iLCJwYXlsb2FkIiwic2lnbiIsImV4cGlyZXNJbiIsInZlcmlmeVRva2VuIiwidG9rZW4iLCJkZWNvZGVkIiwidmVyaWZ5IiwidXNlcklkIiwiZW1haWwiLCJyb2xlIiwiZXJyb3IiLCJnZXRUb2tlbkZyb21SZXF1ZXN0IiwicmVxdWVzdCIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwiZ2V0Iiwic3RhcnRzV2l0aCIsInN1YnN0cmluZyIsImNvb2tpZXMiLCJ2YWx1ZSIsImdldEF1dGhlbnRpY2F0ZWRVc2VyIiwidXNlciIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImlkIiwic2VsZWN0IiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJwcmVmZXJyZWRMYW5ndWFnZSIsImF2YXRhclVybCIsImlzQWN0aXZlIiwiY29uc29sZSIsInZlcmlmeUF1dGgiLCJzdWNjZXNzIiwidmVyaWZ5QWRtaW5BdXRoIiwiYWRtaW4iLCJnZXRBdXRoZW50aWNhdGVkQWRtaW4iLCJuYW1lIiwicGVybWlzc2lvbnMiLCJzYW5pdGl6ZUlucHV0IiwiaW5wdXQiLCJ0cmltIiwicmVwbGFjZSIsImlzVmFsaWRFbWFpbCIsImVtYWlsUmVnZXgiLCJ0ZXN0IiwiaXNWYWxpZFBhc3N3b3JkIiwibGVuZ3RoIiwidmFsaWQiLCJtZXNzYWdlIiwicmF0ZUxpbWl0TWFwIiwiTWFwIiwiY2hlY2tSYXRlTGltaXQiLCJpZGVudGlmaWVyIiwibWF4QXR0ZW1wdHMiLCJ3aW5kb3dNcyIsIm5vdyIsIkRhdGUiLCJyZWNvcmQiLCJyZXNldFRpbWUiLCJzZXQiLCJjb3VudCIsImdldFNlY3VyaXR5SGVhZGVycyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) globalForPrisma.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNkM7QUFFN0MsTUFBTUMsa0JBQWtCQztBQUlqQixNQUFNQyxTQUFTRixnQkFBZ0JFLE1BQU0sSUFBSSxJQUFJSCx3REFBWUEsR0FBRTtBQUVsRSxJQUFJSSxJQUFxQyxFQUFFSCxnQkFBZ0JFLE1BQU0sR0FBR0EiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcdGh1eXRpZW4ubmd1eWVuLlNZU1RFTS1FWEVcXERlc2t0b3BcXDA3MDJcXHZpZXRuYW1lc2UtZWNvbW1lcmNlXFxzcmNcXGxpYlxccHJpc21hLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50J1xyXG5cclxuY29uc3QgZ2xvYmFsRm9yUHJpc21hID0gZ2xvYmFsVGhpcyBhcyB1bmtub3duIGFzIHtcclxuICBwcmlzbWE6IFByaXNtYUNsaWVudCB8IHVuZGVmaW5lZFxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgcHJpc21hID0gZ2xvYmFsRm9yUHJpc21hLnByaXNtYSA/PyBuZXcgUHJpc21hQ2xpZW50KClcclxuXHJcbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID0gcHJpc21hIl0sIm5hbWVzIjpbIlByaXNtYUNsaWVudCIsImdsb2JhbEZvclByaXNtYSIsImdsb2JhbFRoaXMiLCJwcmlzbWEiLCJwcm9jZXNzIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/zod","vendor-chunks/semver","vendor-chunks/bcryptjs","vendor-chunks/jsonwebtoken","vendor-chunks/lodash.includes","vendor-chunks/jws","vendor-chunks/lodash.once","vendor-chunks/jwa","vendor-chunks/lodash.isinteger","vendor-chunks/ecdsa-sig-formatter","vendor-chunks/lodash.isplainobject","vendor-chunks/ms","vendor-chunks/lodash.isstring","vendor-chunks/lodash.isnumber","vendor-chunks/lodash.isboolean","vendor-chunks/safe-buffer","vendor-chunks/buffer-equal-constant-time"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fproducts%2Froute&page=%2Fapi%2Fproducts%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproducts%2Froute.ts&appDir=C%3A%5CUsers%5Cthuytien.nguyen.SYSTEM-EXE%5CDesktop%5C0702%5Cvietnamese-ecommerce%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cthuytien.nguyen.SYSTEM-EXE%5CDesktop%5C0702%5Cvietnamese-ecommerce&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();